## Дорожная карта разработки: «Сундук приключений — Mobile (Solo)»

### Цели продукта и метрики успеха
- Основная цель: короткие сессии 2–4 минуты, понятные решения «идти глубже или выйти», высокая повторяемость.
- Метрики v1: средняя глубина 4–6 уровней; удержание D1 ≥ 30%; длительность сессии 2–4 мин; 0 критических фризов/крэш‑лупов.

### Высокоуровневые вехи (Milestones)
- M0. Проект и инфраструктура
- M1. Игровое ядро v1 (RNG‑спавн/боёвка/уровни/очки/сейв)
- M2. UI/UX v1 (основные экраны, интеракции, подсказки)
- M3. Герои v1 (3 героя: Варвар, Паладин, Тень)
- M4. Сокровища и артефакты v1
- M5. Полировка UX/анимации/доступность
- M6. Мета и аналитика v1
- M7. Аудио/визуал (MVP)
- M8. Тестирование/баланс/оптимизация
- M9. Релиз‑кандидат

### План спринтов (набросок)
- Спринт 1 (M0–M1 частично): фундамент, RNG‑спавн, уровень, дракон, базовый UI
- Спринт 2 (M1 завершение, M2): гейм‑луп, подсказки, базовые анимации
- Спринт 3 (M3–M4): герои, сокровища, эффекты
- Спринт 4 (M5–M6): полировка, доступность, аналитика, простая мета
- Спринт 5 (M7–M8): звук, визуал, баланс/профилирование
- Спринт 6 (M9): релизные артефакты, стор, QA‑регресс

---

## Декомпозиция задач (WBS)

### M0. Проект и инфраструктура
- [ ] Инициализировать Unity проект (LTS), платформа Android, IL2CPP
- [ ] Настройка структуры папок (`Assets/Scripts`, `Assets/Art`, `Assets/UI`, `Assets/Audio`, `Assets/Addressables`)
- [ ] Подключить Addressables (или аналог) для ресурсов
- [ ] Включить и настроить Новую Входную систему (по необходимости)
- [ ] Базовая сцена `Main` с корневым `Game` префабом
- [ ] Документ стиля кода и нейминга (C#), директории `Docs/`
- [ ] CI (по возможности): сборка Android dev; альтернативно — локальные build‑скрипты
- [ ] Система логирования (обёртка над UnityLogger), уровни логов, теги

### M1. Игровое ядро v1
1) Модель данных и контент
- [ ] Перечисления: `AdventurerClass {Warrior, Cleric, Mage, Thief, Champion, Scroll}`
- [ ] Перечисления: `DungeonCard {Goblin, Skeleton, Spirit, Dragon, Chest, Potion}`
- [ ] ScriptableObject карточек приключенцев (иконка, класс, описание)
- [ ] ScriptableObject карточек подземелья (иконка, тип, описание)
- [ ] ScriptableObject сокровищ (иконка, номинал/эффект)
- [ ] Конфиг очков за уровень (1–3=+1, 4–6=+2, 7–9=+3, 10=+5)

2) Генератор спавна (PRNG)
- [ ] `RngSpawner`: инициализация PRNG с seed, сериализация состояния
- [ ] Распределения: приключенцы 1/6; подземелье 1/6; сокровища — таблица выпадения
- [ ] API: `GenerateHand(size)`, `SpawnDungeonRow(level)`, `Reroll(cards)`, `PotionReturn()`
- [ ] Анти‑стрик (опционально): кламп серийных выпадений

3) Машина состояний ран‑петли
- [ ] Состояния: `Init`, `DealHand`, `LevelStart`, `ResolveLevel`, `DragonFight`, `ChooseContinue`, `ExitRun`, `EndRun`
- [ ] Чёткие вход/выход и события переходов

4) Разрешение уровня
- [ ] Сгенерировать L карт подземелья (RNG‑спавн)
- [ ] Детекция дракона (≥3) и переход в `DragonFight`
- [ ] Разыгрывание руки: Воин/Клирик/Маг/Чемпион — очистка типов; Вор — открывает все сундуки; Свиток — редро; Зелье — вернуть 1 карту
- [ ] Применение порядка эффектов, сброс побеждённых
- [ ] Выдача сокровищ, начисление очков/прогресса уровня

5) Схватка с драконом
- [ ] Вход при ≥3 драконах; требование 3 разных класса из {Воин, Клирик, Маг, Чемпион}
- [ ] Успех: +2 ОО, +1 сокровище, очистка драконов; провал — завершение делва без очков за текущий уровень

6) Счёт и завершение делва
- [ ] Начисление очков за максимальный уровень делва
- [ ] Завершение руки и переход к следующему делву (всего 3)

7) Сейв/лоад
- [ ] Автосейв после каждого уровня (рука, состояние PRNG, уровень, очки, добыча)
- [ ] Восстановление сессии при рестарте с тем же seed/состоянием PRNG

### M2. UI/UX v1
- [ ] Вайрфреймы основных экранов (Хаб/Меню, Бой, Результаты)
- [ ] Префабы: `HandView`, `DungeonRowView`, `TreasurePopup`, `DecisionPanel`
- [ ] Интеракции: тап — сыграть; долгий тап — подсказка; свайп вверх — быстрый розыгрыш
- [ ] Подсветка соответствий (например, Воин → Гоблин, Маг → Спирит)
- [ ] Простые анимации: появление/сброс, победа, получение сокровищ
- [ ] Экран результатов делва: очки за уровень, сокровища, кнопки «Продолжить/В меню»
- [ ] Доступность: крупные иконки, высокий контраст, масштаб UI

### M3. Герои v1
- [ ] Данные героя: имя, иконка, пассив, супер‑умение
- [ ] Варвар: первый Воин на уровне не сбрасывается; супер — очистить Гоблинов и Спиритов
- [ ] Паладин: Клирик может убрать 1 Дракона (сбрасываясь); супер — вернуть 2 карты из сброса
- [ ] Тень: каждый Вор даёт +1 доп. сокровище; супер — взглянуть 3 верхние карты подземелья (2 наверх в любом порядке, 1 вниз)
- [ ] UI супер‑кнопки, ограничения по использованию (1 раз за делв)

### M4. Сокровища и артефакты v1
- [ ] Колода сокровищ: Монеты (+1), Драгоценности (+2), 12 особых карт
- [ ] Эффекты особых: одноразовые/пассивы (не ломать баланс ран‑режима)
- [ ] UI инвентаря сокровищ/артефактов

### M5. Полировка UX/анимации/доступность
- [ ] Хайлайты порядка разрешения эффектов
- [ ] Вибро‑фидбек: дракон, провал, редро
- [ ] Настройки: скорость анимаций, режим «минимум эффектов»

### M6. Мета и аналитика v1
- [ ] Аккаунт‑XP: табличка уровней, разблокировка героев/тем
- [ ] Ежедневные задания (минимум 3 паттерна): «дойди до 6 уровня», «победи Дракона» и т.п.
- [ ] Аналитика: схема событий (старт/конец делва, макс‑уровень, победы над драконом, использование Свитков/Зелий, решения выйти/идти дальше, винрейт героев)
- [ ] Интеграция SDK (Unity Analytics или своя шина событий, отложенная отправка)

### M7. Аудио/визуал (MVP)
- [ ] SFX: клики, победы, лут, дракон
- [ ] BGM: спокойная/напряжённая петля
- [ ] Визуальные темы: базовая, высокая контрастность

- ### M8. Тестирование/баланс/оптимизация
- [ ] Юнит‑тесты логики: `RngSpawner`, `CombatResolver`, `DragonFight`, сейв/лоад PRNG
- [ ] Тестовые симуляции ран‑ботом (1000+ прогонов) для проверки глубины/частоты дракона
- [ ] Баланс параметров: размер руки, частота особых, награда за дракона
- [ ] Профилирование: CPU/GPU, GC, память; цели — 60 FPS, без аллокаций в бою
- [ ] Устойчивость: холодный старт < 3 сек, возобновление < 1 сек

### M9. Релиз‑кандидат
- [ ] Сборка RC, регрессионное тестирование по чек‑листу
- [ ] Креш‑репортинг (Unity, Firebase Crashlytics или аналог)
- [ ] Политика конфиденциальности, экран согласий (если требуется)
- [ ] Стор‑артефакты: иконка, скриншоты, описание, рейтинг возрастной категории
- [ ] Внутреннее тестирование (закрытый трек)

---

## Зависимости и риски
- Зависимости: выбор SDK аналитики; наличие базового арта/иконок; ресурсы на звук
- Риски: избыточная рандомность без «памяти колоды»; UX перегруз жестами; сложность меты в v1
- Митигации: режим по умолчанию — без возврата; подсказки/хайлайты; мета минималистична

## Критерии готовности v1 (Definition of Done)
- Стабильный гейм‑луп (3 делва), все роли карт работают
- 3 героя реализованы и сбалансированы до приемлемой сложности
- Базовые сокровища/артефакты, UI понятен и доступен
- Сейв/лоад без потери прогресса; аналитика пишет ключевые события
- 60 FPS на целевых девайсах; нет блокирующих крэшей

## Чек‑лист приемки (QA)
- [ ] Рука стартует с 7 карт; редро работает корректно
- [ ] Спириты побеждаются Магом; Чемпион заменяет недостающий класс
- [ ] 3 Дракона одновременно → бой; успех/провал отрабатывают
- [ ] Вор открывает все сундуки уровня; сокровища выдаются
- [ ] Зелье возвращает карту из сброса в руку
- [ ] Очки уровня суммируются по таблице; итог за делв считается корректно
- [ ] Автосейв после уровня; восстановление сессии
- [ ] Подсветки соответствий и доступность (контраст/масштаб)
- [ ] BGM/SFX проигрываются; без аудио‑артефактов

## Бэклог (послерелиз)
- Больше героев и уникальных артефактов
- Режим «Испытание» (рука 6, усиленная частота дракона)
- Локализация EN/ES
- Достижения и облачные сейвы


